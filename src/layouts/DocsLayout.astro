---
import BaseLayout from './BaseLayout.astro';
import { getAllDocs, GROUP_ORDER } from '../lib/notion';
import DocsSearch from '../components/DocsSearch';

interface Props {
  title: string;
  description?: string;
  currentSlug?: string;
}

const { title, description, currentSlug } = Astro.props;
const allDocs = await getAllDocs();

const grouped = GROUP_ORDER.map(group => ({
  group,
  docs: allDocs.filter(d => d.group === group),
})).filter(g => g.docs.length > 0);
---

<BaseLayout
  title={currentSlug ? `${title} — Clik Docs` : title}
  description={description ?? `Clik documentation: ${title}`}
>
  <div class="flex min-h-screen pt-16" style="background: radial-gradient(ellipse at 90% 0%, rgba(84,129,232,0.13) 0%, transparent 50%)">

    {/* ── Sidebar ── */}
    <aside class="hidden lg:flex flex-col w-64 shrink-0 border-r border-white/5 sticky top-16 h-[calc(100vh-4rem)] overflow-y-auto">
      <div class="px-6 py-7 flex-1">

        {/* Search trigger */}
        <DocsSearch docs={allDocs} client:load />

        {/* Nav groups */}
        {grouped.map(({ group, docs }) => (
          <div class="mb-7">
            <p class="mb-2.5 text-sm font-bold text-white">{group}</p>
            <ul>
              {docs.map(doc => (
                <li>
                  <a
                    href={`/docs/${doc.slug}`}
                    class={`block border-l-2 py-1.5 pl-3.5 text-sm transition-colors ${
                      doc.slug === currentSlug
                        ? 'border-[#5481E8] text-white font-medium'
                        : 'border-transparent text-zinc-500 hover:text-zinc-200 hover:border-[#5481E8]/30'
                    }`}
                  >
                    {doc.title}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ))}

      </div>
    </aside>

    {/* ── Main content ── */}
    <main class="flex-1 min-w-0 mx-auto px-8 py-12 md:px-14 lg:px-16 max-w-3xl">
      <slot />
    </main>

  </div>
</BaseLayout>
