---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import CTASection from '../../components/CTASection.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

function formatDate(date: Date) {
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
}
---
<BaseLayout title={`${entry.data.title} — Clik`} description={entry.data.description}>

  <article class="mx-auto max-w-3xl px-6 pt-28 pb-16">

    <!-- Tags -->
    <div class="flex flex-wrap gap-2 mb-5">
      {entry.data.tags.map((tag) => (
        <span class="text-xs px-2.5 py-1 rounded-full bg-white/[0.06] text-zinc-400 border border-white/[0.08]">
          {tag}
        </span>
      ))}
    </div>

    <!-- Title -->
    <h1 class="text-3xl md:text-4xl font-bold text-brand-cream leading-tight mb-4">
      {entry.data.title}
    </h1>

    <!-- Description + date -->
    <p class="text-lg text-zinc-300 leading-relaxed mb-3">{entry.data.description}</p>
    <time class="text-sm text-zinc-500 block mb-10" datetime={entry.data.date.toISOString()}>
      {formatDate(entry.data.date)}
    </time>

    <!-- Cover image -->
    <div class="rounded-xl overflow-hidden mb-12 aspect-video bg-zinc-900">
      <img
        src={entry.data.coverImage}
        alt={entry.data.title}
        class="w-full h-full object-cover"
        onerror="this.src='/images/articles/placeholder.svg'"
      />
    </div>

    <!-- Body -->
    <div class="prose prose-invert prose-brand max-w-none">
      <Content />
    </div>

    <!-- Back link -->
    <div class="mt-16 pt-8 border-t border-white/[0.08]">
      <a href="/blog" class="text-sm text-brand-magenta hover:text-brand-coral transition-colors">
        ← Back to Blog
      </a>
    </div>

  </article>

  <CTASection />

</BaseLayout>

<style is:global>
  /* Brand-tuned prose overrides */
  .prose-brand {
    --tw-prose-body: #c4bfcc;
    --tw-prose-headings: #F9F7F1;
    --tw-prose-lead: #a09aac;
    --tw-prose-links: #DC1DD9;
    --tw-prose-bold: #F9F7F1;
    --tw-prose-counters: #6b7280;
    --tw-prose-bullets: #4b5563;
    --tw-prose-hr: rgba(255,255,255,0.08);
    --tw-prose-quotes: #F9F7F1;
    --tw-prose-quote-borders: #DC1DD9;
    --tw-prose-captions: #6b7280;
    --tw-prose-code: #F9838E;
    --tw-prose-pre-code: #F9F7F1;
    --tw-prose-pre-bg: rgba(255,255,255,0.04);
    --tw-prose-th-borders: rgba(255,255,255,0.1);
    --tw-prose-td-borders: rgba(255,255,255,0.06);
  }
  .prose-brand h2 { margin-top: 2.5rem; }
  .prose-brand h3 { margin-top: 2rem; }
  .prose-brand a { text-decoration: none; border-bottom: 1px solid rgba(220,29,217,0.4); transition: border-color 0.2s; }
  .prose-brand a:hover { border-color: #DC1DD9; }
  .prose-brand table { font-size: 0.875rem; }
  .prose-brand th { background: rgba(255,255,255,0.04); }
  .prose-brand img { border-radius: 0.75rem; }
  .prose-brand .placeholder-img { opacity: 0.6; }
  /* Blockquote accent */
  .prose-brand blockquote { border-left-color: #DC1DD9; background: rgba(220,29,217,0.05); padding: 1rem 1.25rem; border-radius: 0 0.5rem 0.5rem 0; }
</style>
